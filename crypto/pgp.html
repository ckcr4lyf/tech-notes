<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PGP - tech-notes</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Running some services</li><li class="chapter-item expanded "><a href="../services/bitcoin_core.html"><strong aria-hidden="true">1.</strong> Running bitcoin-core on a VPS</a></li><li class="chapter-item expanded "><a href="../services/monero/monero_ubuntu.html"><strong aria-hidden="true">2.</strong> Running monero on a VPS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/monero/monero_wallet_tor.html"><strong aria-hidden="true">2.1.</strong> Connecting a monero wallet to a node over tor</a></li></ol></li><li class="chapter-item expanded "><a href="../services/cftunnel.html"><strong aria-hidden="true">3.</strong> Exposting a local webservice over the internet via Cloudflare Tunnel</a></li><li class="chapter-item expanded "><a href="../services/ntopng/ntopng.html"><strong aria-hidden="true">4.</strong> ntopng</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/ntopng/installation.html"><strong aria-hidden="true">4.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../services/nginx/nginx.html"><strong aria-hidden="true">5.</strong> nginx</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/nginx/nginx-h3.html"><strong aria-hidden="true">5.1.</strong> Running HTTP/3 enabled nginx</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/nginx/nginx-h3-config.html"><strong aria-hidden="true">5.1.1.</strong> Setting up TLS and Config</a></li></ol></li><li class="chapter-item expanded "><a href="../services/nginx/nginx-ech.html"><strong aria-hidden="true">5.2.</strong> Running ECH enabled nginx</a></li><li class="chapter-item expanded "><a href="../services/nginx/signed.cert.html"><strong aria-hidden="true">5.3.</strong> CA Signed TLS certificates</a></li></ol></li><li class="chapter-item expanded "><a href="../services/wireguard/index.html"><strong aria-hidden="true">6.</strong> Wireguard</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/wireguard/server.html"><strong aria-hidden="true">6.1.</strong> Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/wireguard/obfuscation.html"><strong aria-hidden="true">6.1.1.</strong> Obfuscation</a></li></ol></li><li class="chapter-item expanded "><a href="../services/wireguard/client.html"><strong aria-hidden="true">6.2.</strong> Client</a></li></ol></li><li class="chapter-item expanded "><a href="../services/email/index.html"><strong aria-hidden="true">7.</strong> Email</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/email/maintenance.html"><strong aria-hidden="true">7.1.</strong> Maintenance</a></li></ol></li><li class="chapter-item expanded "><a href="../services/proxy/index.html"><strong aria-hidden="true">8.</strong> HTTP(S) Proxy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services/proxy/maintenance.html"><strong aria-hidden="true">8.1.</strong> Maintenance</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Installing stuff (OS specific)</li><li class="chapter-item expanded "><a href="../tor_ubuntu.html"><strong aria-hidden="true">9.</strong> Installing tor on ubuntu</a></li><li class="chapter-item expanded "><a href="../install/programming.html"><strong aria-hidden="true">10.</strong> Installing some programming languages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../install/node.html"><strong aria-hidden="true">10.1.</strong> Installing Node.JS</a></li><li class="chapter-item expanded "><a href="../install/rust.html"><strong aria-hidden="true">10.2.</strong> Installing Rust</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Crypto</li><li class="chapter-item expanded "><a href="../crypto/crypto.html"><strong aria-hidden="true">11.</strong> Crypto Stuff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../crypto/pgp.html" class="active"><strong aria-hidden="true">11.1.</strong> PGP</a></li><li class="chapter-item expanded "><a href="../crypto/openssl/index.html"><strong aria-hidden="true">11.2.</strong> OpenSSL</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../crypto/openssl/tls.html"><strong aria-hidden="true">11.2.1.</strong> Generating TLS certificates</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">Miscellaneous Tips</li><li class="chapter-item expanded "><a href="../wireshark/index.html"><strong aria-hidden="true">12.</strong> Wireshark</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../wireshark/remote.html"><strong aria-hidden="true">12.1.</strong> Remote Wireshark</a></li><li class="chapter-item expanded "><a href="../wireshark/tls.html"><strong aria-hidden="true">12.2.</strong> TLS Inspection</a></li></ol></li><li class="chapter-item expanded "><a href="../sway/index.html"><strong aria-hidden="true">13.</strong> Sway</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../sway/transparent.html"><strong aria-hidden="true">13.1.</strong> Transparent Screenlock</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Audio/Video/Encoding</li><li class="chapter-item expanded "><a href="../av1_encoding.html"><strong aria-hidden="true">14.</strong> AV1 encoding for BluRays</a></li><li class="chapter-item expanded "><a href="../ogg_aac_ipod.html"><strong aria-hidden="true">15.</strong> Encoding ogg files for iPod</a></li><li class="chapter-item expanded "><a href="../ffmpeg/index.html"><strong aria-hidden="true">16.</strong> Miscellaneous ffmpeg goodies</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ffmpeg/screen.html"><strong aria-hidden="true">16.1.</strong> Encoding Instant Replay to share online</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">tech-notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pgp"><a class="header" href="#pgp">PGP</a></h1>
<p>PGP is great for signing and encryption. Signing is an especially valuable concept, since it has stronger guarantees on the author as opposed to any kind of e.g. social media profile, which by nature have backdoors accessible by staff.</p>
<h2 id="keygen"><a class="header" href="#keygen">Keygen</a></h2>
<p>We will use keys based on <a href="https://en.wikipedia.org/wiki/Curve25519">Curve25519</a>. For signing, this means <a href="https://en.wikipedia.org/wiki/EdDSA#Ed25519">Ed25519</a>, and for encryption <a href="https://x25519.xargs.org/">X25519</a>.</p>
<p>We will first generate a master ceritification key. The password for this guy should be very strong. For the subsequent subkeys we will change the password later.</p>
<pre><code>gpg --quick-generate-key 'Your Name &lt;email@domain.com&gt;' ed25519 cert never
</code></pre>
<p>You should get something like:</p>
<pre><code>pub   ed25519 2024-03-25 [C]
      224245002A2A0003CD7CF693FFC081E4E8D5FA41
uid                      Your Name &lt;email@domain.com&gt;
</code></pre>
<p>The long hex string is the key fingerprint. We will save it in a temporary variable for generating the subkeys:</p>
<pre><code>export KEYFP=224245002A2A0003CD7CF693FFC081E4E8D5FA41
</code></pre>
<p>Now we will generate the subkeys for signing and encryption. Here we will use a 3 year expiration, you can change it to something else if you'd like:</p>
<pre><code>gpg --quick-add-key $KEYFP ed25519 sign 3y
gpg --quick-add-key $KEYFP cv25519 encr 3y
</code></pre>
<p>Our keyring should now look like:</p>
<pre><code>$ gpg -K --with-keygrip

sec   ed25519 2024-03-25 [C]
      224245002A2A0003CD7CF693FFC081E4E8D5FA41
      Keygrip = FCC73C8DA31BEB61ECF3B2316131CBF9AFE02675
uid           [ultimate] Your Name &lt;email@domain.com&gt;
ssb   ed25519 2024-03-25 [S] [expires: 2027-03-25]
      Keygrip = 5C407E3653C2BC7C1E4F06BB1179A9A317A88F52
ssb   cv25519 2024-03-25 [E] [expires: 2027-03-25]
      Keygrip = EBA000BD362AE3CFC512730544B133E7BBA7E217
</code></pre>
<p>Now that we generated the subkeys for signing and encryption, we can delete the master key. But we need to first save it, for when we need to generate new keys (e.g. after the current ones expire).</p>
<p>Back up the master key via</p>
<pre><code>$ gpg --armor --export-secret-keys $KEYFP &gt; gpg_master_key.asc
</code></pre>
<p>Now, we will delete the master key from our keyring. Go to your private key directory (usually <code>~/.gnupg</code>), and delete the file matching the keygrip of the <code>sec</code> key. In our case it is <code>FCC73C8DA31BEB61ECF3B2316131CBF9AFE02675.key</code>.</p>
<p>Now when you view your keyring, GPG will print <code>sec#</code> indicating the secret key is not available:</p>
<pre><code>sec#  ed25519 2024-03-25 [C]
      224245002A2A0003CD7CF693FFC081E4E8D5FA41
      Keygrip = FCC73C8DA31BEB61ECF3B2316131CBF9AFE02675
uid           [ultimate] Your Name &lt;email@domain.com&gt;
ssb   ed25519 2024-03-25 [S] [expires: 2027-03-25]
      Keygrip = 5C407E3653C2BC7C1E4F06BB1179A9A317A88F52
ssb   cv25519 2024-03-25 [E] [expires: 2027-03-25]
      Keygrip = EBA000BD362AE3CFC512730544B133E7BBA7E217
</code></pre>
<p>Make sure to save <code>gpg_master_key.asc</code> somewhere encrypted for when you need it!</p>
<h2 id="updating-the-password"><a class="header" href="#updating-the-password">Updating the password</a></h2>
<p>Now with the master key deleted from your keyring, we can edit the password for the subkeys.</p>
<p>Run <code>gpg -K --keyid-format 0xLONG</code> , and copy the KEYID of your master key. It would look something like:</p>
<pre><code>sec#  ed25519/0xFFC081E4E8D5FA41 2024-03-25 [C]
</code></pre>
<p>Tell GPG you want to edit the key</p>
<pre><code>gpg --edit-key 0xFFC081E4E8D5FA41
</code></pre>
<p>At the <code>gpg&gt; </code> prompt, type <code>passwd</code> . This will prompt you for the current password, which would be the strong password set when generating the master key.</p>
<p>After entering that, it will ask you for a new password. Put in whatever you want.</p>
<p>Finally, at the <code>gpg&gt; </code> prompt, type <code>quit</code> to finish.</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li>https://github.com/drduh/YubiKey-Guide</li>
<li>https://musigma.blog/2021/05/09/gpg-ssh-ed25519.html</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../crypto/crypto.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../crypto/openssl/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../crypto/crypto.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../crypto/openssl/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
